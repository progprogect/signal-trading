<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSI Signals Bot - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .signal-card {
            transition: transform 0.2s;
            border-left: 4px solid #007bff;
        }
        .signal-card:hover {
            transform: translateY(-2px);
        }
        .signal-oversold { border-left-color: #dc3545; }
        .signal-overbought { border-left-color: #ffc107; }
        .signal-exit { border-left-color: #28a745; }
        .historical-signal { opacity: 0.8; border-style: dashed; }
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .refresh-btn {
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .nav-tabs .nav-link.active {
            background-color: #007bff;
            color: white;
        }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <span class="navbar-brand mb-0 h1">
                <i class="fas fa-chart-line"></i> RSI Signals Bot
            </span>
            <div class="d-flex">
                <span class="badge bg-success me-2" id="status-badge">
                    <i class="fas fa-circle"></i> –†–∞–±–æ—Ç–∞–µ—Ç
                </span>
                <button class="btn btn-outline-light btn-sm" onclick="refreshData()">
                    <i class="fas fa-sync-alt" id="refresh-icon"></i>
                </button>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <h4 id="total-signals">{{ signals|length }}</h4>
                        <small>–í—Å–µ–≥–æ —Å–∏–≥–Ω–∞–ª–æ–≤</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <h4 id="active-symbols">{{ settings.symbols|length }}</h4>
                        <small>–ê–∫—Ç–∏–≤–Ω—ã—Ö –º–æ–Ω–µ—Ç</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <h4>{{ settings.timeframe }}</h4>
                        <small>–¢–∞–π–º—Ñ—Ä–µ–π–º</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <h4>{{ settings.rsi_oversold }}/{{ settings.rsi_overbought }}</h4>
                        <small>–£—Ä–æ–≤–Ω–∏ RSI</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h5>
                    </div>
                    <div class="card-body">
                        <form id="settings-form">
                            <!-- –¢–∞–π–º—Ñ—Ä–µ–π–º -->
                            <div class="mb-4">
                                <label class="form-label"><strong>üìä –¢–∞–π–º—Ñ—Ä–µ–π–º –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</strong></label>
                                <select class="form-select" id="timeframe">
                                    {% for tf in available_timeframes %}
                                    <option value="{{ tf }}" {% if tf == settings.timeframe %}selected{% endif %}>
                                        {{ tf }} {% if tf == '5m' %}(—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è){% endif %}
                                    </option>
                                    {% endfor %}
                                </select>
                                <div class="form-text">–ò–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ RSI: —á–µ–º –º–µ–Ω—å—à–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª, —Ç–µ–º –±–æ–ª—å—à–µ —Å–∏–≥–Ω–∞–ª–æ–≤</div>
                            </div>

                            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ RSI —É—Ä–æ–≤–Ω—è—Ö -->
                            <div class="mb-4">
                                <label class="form-label"><strong>‚öôÔ∏è –£—Ä–æ–≤–Ω–∏ RSI</strong></label>
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle"></i> 
                                    <strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É—Ä–æ–≤–Ω–∏:</strong><br>
                                    üî¥ –ü–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å: {{ settings.rsi_oversold }}<br>
                                    üü° –ü–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å: {{ settings.rsi_overbought }}<br>
                                    <small>–≠—Ç–∏ —É—Ä–æ–≤–Ω–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã –∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è</small>
                                </div>
                            </div>

                            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∞–º–∏ -->
                            <div class="mb-4">
                                <label class="form-label"><strong>üí∞ –ú–æ–Ω–µ—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</strong></label>
                                
                                <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ -->
                                <div class="alert alert-warning mb-3">
                                    <h6><i class="fas fa-lightbulb"></i> –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–≤–æ–¥–∏—Ç—å —Å–∏–º–≤–æ–ª—ã:</h6>
                                    <ul class="mb-2">
                                        <li><strong>–§–æ—Ä–º–∞—Ç:</strong> <code>BTCUSDT</code> (–Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–Ω–µ—Ç—ã + USDT)</li>
                                        <li><strong>–ü—Ä–∏–º–µ—Ä—ã:</strong> BTC, DOGE, PEPE, SUI, BIGTIME, ALT, WLD</li>
                                        <li><strong>–ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ:</strong> –º–æ–∂–Ω–æ –≤–≤–æ–¥–∏—Ç—å –±–µ–∑ USDT (–¥–æ–±–∞–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)</li>
                                        <li><strong>–†–µ–≥–∏—Å—Ç—Ä:</strong> –Ω–µ –≤–∞–∂–µ–Ω (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤–µ–¥–µ—Ç—Å—è –∫ –≤–µ—Ä—Ö–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É)</li>
                                    </ul>
                                </div>

                                <!-- –ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –º–æ–Ω–µ—Ç -->
                                <div class="mb-3">
                                    <label class="form-label">üöÄ –ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –º–æ–Ω–µ—Ç:</label>
                                    <div class="d-flex flex-wrap gap-2 mb-3">
                                        <button type="button" class="btn btn-outline-success btn-sm" onclick="addQuickSymbol('BTC')">
                                            ‚Çø BTC
                                        </button>
                                        <button type="button" class="btn btn-outline-success btn-sm" onclick="addQuickSymbol('ETH')">
                                            Œû ETH
                                        </button>
                                        <button type="button" class="btn btn-outline-success btn-sm" onclick="addQuickSymbol('DOGE')">
                                            üêï DOGE
                                        </button>
                                        <button type="button" class="btn btn-outline-success btn-sm" onclick="addQuickSymbol('PEPE')">
                                            üê∏ PEPE
                                        </button>
                                        <button type="button" class="btn btn-outline-success btn-sm" onclick="addQuickSymbol('SUI')">
                                            üåä SUI
                                        </button>
                                        <button type="button" class="btn btn-outline-success btn-sm" onclick="addQuickSymbol('BIGTIME')">
                                            ‚è∞ BIGTIME
                                        </button>
                                        <button type="button" class="btn btn-outline-success btn-sm" onclick="addQuickSymbol('ALT')">
                                            ‚≠ê ALT
                                        </button>
                                        <button type="button" class="btn btn-outline-success btn-sm" onclick="addQuickSymbol('WLD')">
                                            üåç WLD
                                        </button>
                                    </div>
                                </div>

                                <!-- –°–ø–∏—Å–æ–∫ —Ç–µ–∫—É—â–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ -->
                                <div id="symbols-container">
                                    {% for symbol in settings.symbols %}
                                    <div class="input-group mb-2 symbol-input">
                                        <span class="input-group-text">üí∞</span>
                                        <input type="text" class="form-control" value="{{ symbol }}" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: BTCUSDT –∏–ª–∏ BTC">
                                        <button class="btn btn-outline-danger" type="button" onclick="removeSymbol(this)" title="–£–¥–∞–ª–∏—Ç—å —Å–∏–º–≤–æ–ª">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                    {% endfor %}
                                </div>
                                
                                <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                                <div class="d-flex gap-2">
                                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="addSymbol()">
                                        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–µ—Ç—É
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="clearAllSymbols()">
                                        <i class="fas fa-broom"></i> –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ
                                    </button>
                                    <button type="button" class="btn btn-outline-info btn-sm" onclick="validateSymbols()">
                                        <i class="fas fa-check"></i> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–º–≤–æ–ª—ã
                                    </button>
                                </div>
                                
                                <!-- –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ -->
                                <div class="mt-2">
                                    <small class="text-muted">
                                        <i class="fas fa-info-circle"></i> 
                                        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç: <span id="symbols-count">{{ settings.symbols|length }}</span>
                                        (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 3-8 –º–æ–Ω–µ—Ç –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã)
                                    </small>
                                </div>
                            </div>

                            <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
                            <button type="submit" class="btn btn-success w-100 btn-lg">
                                <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- –°–∏–≥–Ω–∞–ª—ã -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è RSI —Å–∏–≥–Ω–∞–ª–æ–≤</h5>
                    </div>
                    
                    <div class="card-body">
                        <!-- –§–∏–ª—å—Ç—Ä—ã -->
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <select class="form-select" id="symbol-filter">
                                    <option value="">–í—Å–µ –º–æ–Ω–µ—Ç—ã</option>
                                    {% for symbol in settings.symbols %}
                                    <option value="{{ symbol }}">{{ symbol }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-4">
                                <select class="form-select" id="signal-type-filter">
                                    <option value="">–í—Å–µ —Ç–∏–ø—ã —Å–∏–≥–Ω–∞–ª–æ–≤</option>
                                    <option value="important">–¢–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã–µ (–≤—Ö–æ–¥—ã –≤ –∑–æ–Ω—ã)</option>
                                    <option value="oversold_enter">üî¥ –¢–æ–ª—å–∫–æ –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å</option>
                                    <option value="overbought_enter">üü° –¢–æ–ª—å–∫–æ –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-outline-primary w-100" onclick="refreshSignalsHistory()">
                                    <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                                </button>
                            </div>
                            <div class="col-md-12 mt-2">
                                <button class="btn btn-warning btn-sm" onclick="clearCacheAndReload()">
                                    <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
                                </button>
                            </div>
                        </div>

                        <!-- –ì—Ä—É–ø–ø—ã —Å–∏–≥–Ω–∞–ª–æ–≤ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ -->
                        <div style="max-height: 700px; overflow-y: auto;" id="signals-history-container">
                            <!-- –°–µ–≥–æ–¥–Ω—è -->
                            <div class="mb-4" id="today-section">
                                <h6 class="text-primary border-bottom pb-2">
                                    <i class="fas fa-calendar-day"></i> –°–µ–≥–æ–¥–Ω—è
                                </h6>
                                <div id="today-signals">
                                    <div class="text-center text-muted py-3">
                                        <small>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤...</small>
                                    </div>
                                </div>
                            </div>

                            <!-- –ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ -->
                            <div class="mb-4" id="this-week-section">
                                <h6 class="text-info border-bottom pb-2">
                                    <i class="fas fa-calendar-week"></i> –ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ
                                </h6>
                                <div id="this-week-signals">
                                    <div class="text-center text-muted py-3">
                                        <small>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤...</small>
                                    </div>
                                </div>
                            </div>

                            <!-- –ù–∞ –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–µ -->
                            <div class="mb-4" id="last-week-section">
                                <h6 class="text-secondary border-bottom pb-2">
                                    <i class="fas fa-calendar-alt"></i> –ù–∞ –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–µ
                                </h6>
                                <div id="last-week-signals">
                                    <div class="text-center text-muted py-3">
                                        <small>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤...</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(refreshSignalsHistory, 30000);

        function refreshData() {
            const icon = document.getElementById('refresh-icon');
            icon.classList.add('refresh-btn');
            
            refreshSignalsHistory();
            
            setTimeout(() => {
                icon.classList.remove('refresh-btn');
            }, 2000);
        }

        function clearCacheAndReload() {
            // –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –±—Ä–∞—É–∑–µ—Ä–∞
            if ('caches' in window) {
                caches.keys().then(function(names) {
                    for (let name of names) {
                        caches.delete(name);
                    }
                });
            }
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –±–µ–∑ –∫—ç—à–∞
            window.location.reload(true);
        }

        async function refreshSignalsHistory() {
            try {
                // –î–æ–±–∞–≤–ª—è–µ–º timestamp –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
                const timestamp = new Date().getTime();
                const response = await fetch(`/api/signals?limit=200&_t=${timestamp}`);
                const signals = await response.json();
                groupAndDisplaySignals(signals);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                document.getElementById('total-signals').textContent = signals.length;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤:', error);
            }
        }

        function groupAndDisplaySignals(signals) {
            const symbolFilter = document.getElementById('symbol-filter').value;
            const typeFilter = document.getElementById('signal-type-filter').value;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
            let filteredSignals = signals;
            
            if (symbolFilter) {
                filteredSignals = filteredSignals.filter(s => s.symbol === symbolFilter);
            }
            
            if (typeFilter === 'important') {
                filteredSignals = filteredSignals.filter(s => 
                    s.signal_type === 'oversold_enter' || s.signal_type === 'overbought_enter'
                );
            } else if (typeFilter) {
                filteredSignals = filteredSignals.filter(s => s.signal_type === typeFilter);
            }
            
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const thisWeekStart = new Date(today.getTime() - (today.getDay() * 24 * 60 * 60 * 1000));
            const lastWeekStart = new Date(thisWeekStart.getTime() - (7 * 24 * 60 * 60 * 1000));
            
            const todaySignals = [];
            const thisWeekSignals = [];
            const lastWeekSignals = [];
            
            filteredSignals.forEach(signal => {
                const signalDate = new Date(signal.timestamp);
                
                if (signalDate >= today) {
                    todaySignals.push(signal);
                } else if (signalDate >= thisWeekStart) {
                    thisWeekSignals.push(signal);
                } else if (signalDate >= lastWeekStart) {
                    lastWeekSignals.push(signal);
                }
            });
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≥—Ä—É–ø–ø—ã
            displaySignalGroup('today-signals', todaySignals, '–°–µ–≥–æ–¥–Ω—è —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
            displaySignalGroup('this-week-signals', thisWeekSignals, '–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
            displaySignalGroup('last-week-signals', lastWeekSignals, '–ù–∞ –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–µ —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
        }
        
        function displaySignalGroup(containerId, signals, emptyMessage) {
            const container = document.getElementById(containerId);
            
            if (signals.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-muted py-3">
                        <small>${emptyMessage}</small>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = signals.map(signal => createSignalCard(signal)).join('');
        }
        
        function createSignalCard(signal) {
            const signalType = signal.signal_type;
            let badgeClass = 'bg-primary';
            let signalText = '–°–∏–≥–Ω–∞–ª';
            
            if (signalType.includes('oversold')) {
                if (signalType.includes('enter')) {
                    badgeClass = 'bg-danger';
                    signalText = 'üî¥ –ü–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω';
                } else {
                    badgeClass = 'bg-success';
                    signalText = 'üü¢ –í—ã—Ö–æ–¥ –∏–∑ –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω';
                }
            } else if (signalType.includes('overbought')) {
                if (signalType.includes('enter')) {
                    badgeClass = 'bg-warning text-dark';
                    signalText = 'üü° –ü–µ—Ä–µ–∫—É–ø–ª–µ–Ω';
                } else {
                    badgeClass = 'bg-info';
                    signalText = 'üîµ –í—ã—Ö–æ–¥ –∏–∑ –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω';
                }
            }
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è
            const signalDate = new Date(signal.timestamp);
            const dateStr = signalDate.toLocaleDateString('ru-RU');
            const timeStr = signalDate.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            
            // –ü–æ–ª—É—á–∞–µ–º —Å–∏–º–≤–æ–ª –±–µ–∑ USDT –¥–ª—è —ç–º–æ–¥–∑–∏
            const symbolEmoji = {
                'BTCUSDT': '‚Çø', 'DOGEUSDT': 'üêï', 'PEPEUSDT': 'üê∏',
                'SUIUSDT': 'üåä', 'BIGTIMEUSDT': '‚è∞', 'ALTUSDT': '‚≠ê',
                'WLDUSDT': 'üåç'
            }[signal.symbol] || 'üí∞';
            
            return `
                <div class="card signal-card mb-2">
                    <div class="card-body py-2">
                        <div class="row align-items-center">
                            <div class="col-2">
                                <strong>${symbolEmoji} ${signal.symbol.replace('USDT', '')}</strong>
                                <br><small class="text-muted">${signal.timeframe}</small>
                            </div>
                            <div class="col-3">
                                <span class="badge ${badgeClass}">${signalText}</span>
                                <br><small class="text-muted">${dateStr} ${timeStr}</small>
                            </div>
                            <div class="col-3">
                                <small>RSI: <strong>${signal.rsi_value.toFixed(2)}</strong></small>
                                <br><small>–¶–µ–Ω–∞: <strong>$${signal.price.toFixed(6)}</strong></small>
                            </div>
                            <div class="col-2">
                                <small class="text-muted">–ü—Ä–µ–¥—ã–¥—É—â–∏–π RSI:</small>
                                <br><small><strong>${signal.previous_rsi ? signal.previous_rsi.toFixed(2) : 'N/A'}</strong></small>
                            </div>
                            <div class="col-2 text-end">
                                <a href="https://www.tradingview.com/chart/?symbol=BINANCE:${signal.symbol.replace('USDT', 'USD')}" 
                                   target="_blank" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-chart-line"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            refreshSignalsHistory();
            updateSymbolsCount();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª–µ–π —Å–∏–º–≤–æ–ª–æ–≤
            document.querySelectorAll('#symbols-container input').forEach(input => {
                input.addEventListener('input', updateSymbolsCount);
            });
        });

        function addSymbol() {
            const container = document.getElementById('symbols-container');
            const div = document.createElement('div');
            div.className = 'input-group mb-2 symbol-input';
            div.innerHTML = `
                <span class="input-group-text">üí∞</span>
                <input type="text" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: BTCUSDT –∏–ª–∏ BTC" onkeyup="updateSymbolsCount()">
                <button class="btn btn-outline-danger" type="button" onclick="removeSymbol(this)" title="–£–¥–∞–ª–∏—Ç—å —Å–∏–º–≤–æ–ª">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            container.appendChild(div);
            updateSymbolsCount();
        }

        function removeSymbol(button) {
            button.closest('.symbol-input').remove();
            updateSymbolsCount();
        }

        function addQuickSymbol(symbol) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π —Å–∏–º–≤–æ–ª
            const inputs = document.querySelectorAll('#symbols-container input');
            const symbolWithUsdt = symbol.toUpperCase().endsWith('USDT') ? symbol.toUpperCase() : symbol.toUpperCase() + 'USDT';
            
            for (let input of inputs) {
                const currentValue = input.value.trim().toUpperCase();
                const currentWithUsdt = currentValue.endsWith('USDT') ? currentValue : currentValue + 'USDT';
                if (currentWithUsdt === symbolWithUsdt) {
                    // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç
                    input.style.border = '2px solid #28a745';
                    setTimeout(() => {
                        input.style.border = '';
                    }, 2000);
                    return;
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —Å–∏–º–≤–æ–ª
            const container = document.getElementById('symbols-container');
            const div = document.createElement('div');
            div.className = 'input-group mb-2 symbol-input';
            div.innerHTML = `
                <span class="input-group-text">üí∞</span>
                <input type="text" class="form-control" value="${symbolWithUsdt}" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: BTCUSDT –∏–ª–∏ BTC" onkeyup="updateSymbolsCount()">
                <button class="btn btn-outline-danger" type="button" onclick="removeSymbol(this)" title="–£–¥–∞–ª–∏—Ç—å —Å–∏–º–≤–æ–ª">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            container.appendChild(div);
            updateSymbolsCount();
        }

        function clearAllSymbols() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –º–æ–Ω–µ—Ç—ã? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                document.getElementById('symbols-container').innerHTML = '';
                updateSymbolsCount();
            }
        }

        function validateSymbols() {
            const inputs = document.querySelectorAll('#symbols-container input');
            let validCount = 0;
            let invalidSymbols = [];
            
            inputs.forEach(input => {
                const value = input.value.trim().toUpperCase();
                if (!value) {
                    input.style.border = '2px solid #ffc107';
                    return;
                }
                
                const symbolWithUsdt = value.endsWith('USDT') ? value : value + 'USDT';
                
                // –ü—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
                if (symbolWithUsdt.length >= 5 && symbolWithUsdt.endsWith('USDT') && /^[A-Z]+USDT$/.test(symbolWithUsdt)) {
                    input.style.border = '2px solid #28a745';
                    input.value = symbolWithUsdt;
                    validCount++;
                } else {
                    input.style.border = '2px solid #dc3545';
                    invalidSymbols.push(value);
                }
            });
            
            // –°–±—Ä–æ—Å —Å—Ç–∏–ª–µ–π —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                inputs.forEach(input => {
                    input.style.border = '';
                });
            }, 3000);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            if (invalidSymbols.length > 0) {
                alert(`–ù–∞–π–¥–µ–Ω—ã –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã: ${invalidSymbols.join(', ')}\n\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç: BTCUSDT, DOGEUSDT –∏ —Ç.–¥.`);
            } else if (validCount > 0) {
                alert(`‚úÖ –í—Å–µ ${validCount} —Å–∏–º–≤–æ–ª–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã!`);
            } else {
                alert('‚ö†Ô∏è –î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –º–æ–Ω–µ—Ç—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞');
            }
        }

        function updateSymbolsCount() {
            const count = document.querySelectorAll('#symbols-container .symbol-input').length;
            document.getElementById('symbols-count').textContent = count;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
            const countElement = document.getElementById('symbols-count');
            if (count === 0) {
                countElement.style.color = '#dc3545';
            } else if (count >= 3 && count <= 8) {
                countElement.style.color = '#28a745';
            } else {
                countElement.style.color = '#ffc107';
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫
        document.getElementById('settings-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // –°–æ–±–∏—Ä–∞–µ–º —Å–∏–º–≤–æ–ª—ã
            const symbolInputs = document.querySelectorAll('#symbols-container input');
            const symbols = Array.from(symbolInputs)
                .map(input => input.value.trim().toUpperCase())
                .filter(value => value)
                .map(symbol => symbol.endsWith('USDT') ? symbol : symbol + 'USDT');
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
            if (symbols.length === 0) {
                alert('‚ö†Ô∏è –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –º–æ–Ω–µ—Ç—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞!');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
            const uniqueSymbols = [...new Set(symbols)];
            if (uniqueSymbols.length !== symbols.length) {
                alert('‚ö†Ô∏è –ù–∞–π–¥–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Å–∏–º–≤–æ–ª—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–¥–∞–ª–∏—Ç–µ –ø–æ–≤—Ç–æ—Ä—ã.');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Å–∏–º–≤–æ–ª–æ–≤
            const invalidSymbols = uniqueSymbols.filter(symbol => 
                symbol.length < 5 || !symbol.endsWith('USDT') || !/^[A-Z]+USDT$/.test(symbol)
            );
            
            if (invalidSymbols.length > 0) {
                alert(`‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã: ${invalidSymbols.join(', ')}\n\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç: BTCUSDT, DOGEUSDT –∏ —Ç.–¥.`);
                return;
            }
            
            const settings = {
                symbols: uniqueSymbols,
                timeframe: document.getElementById('timeframe').value
            };
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            const submitBtn = document.querySelector('#settings-form button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
            submitBtn.disabled = true;
            
            try {
                const response = await fetch('/api/settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                    submitBtn.innerHTML = '<i class="fas fa-check"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!';
                    submitBtn.className = 'btn btn-success w-100 btn-lg';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ 1.5 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        location.reload();
                    }, 1500);
                } else {
                    throw new Error(result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫:', error);
                alert(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫:\n${error.message}`);
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                submitBtn.innerHTML = originalText;
                submitBtn.className = 'btn btn-success w-100 btn-lg';
                submitBtn.disabled = false;
            }
        });

        // –§–∏–ª—å—Ç—Ä—ã
        document.getElementById('symbol-filter').addEventListener('change', refreshSignalsHistory);
        document.getElementById('signal-type-filter').addEventListener('change', refreshSignalsHistory);
    </script>
</body>
</html> 
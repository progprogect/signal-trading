<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSI Signals Bot - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .signal-card { transition: transform 0.2s; border-left: 4px solid #007bff; }
        .signal-card:hover { transform: translateY(-2px); }
        .signal-oversold { border-left-color: #dc3545; }
        .signal-overbought { border-left-color: #ffc107; }
        .stats-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .refresh-btn { animation: spin 2s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .nav-tabs .nav-link.active { background-color: #007bff; color: white; }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <span class="navbar-brand mb-0 h1">
                <i class="fas fa-chart-line"></i> RSI Signals Bot
            </span>
            <div class="d-flex">
                <span class="badge bg-success me-2">
                    <i class="fas fa-circle"></i> –†–∞–±–æ—Ç–∞–µ—Ç
                </span>
                <button class="btn btn-outline-light btn-sm" onclick="refreshData()">
                    <i class="fas fa-sync-alt" id="refresh-icon"></i>
                </button>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <h4 id="total-signals">{{ signals|length }}</h4>
                        <small>–í—Å–µ–≥–æ —Å–∏–≥–Ω–∞–ª–æ–≤</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <h4 id="active-symbols">{{ settings.symbols|length }}</h4>
                        <small>–ê–∫—Ç–∏–≤–Ω—ã—Ö –º–æ–Ω–µ—Ç</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <h4>{{ settings.timeframe }}</h4>
                        <small>–¢–∞–π–º—Ñ—Ä–µ–π–º</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <h4>{{ settings.rsi_oversold }}/{{ settings.rsi_overbought }}</h4>
                        <small>–£—Ä–æ–≤–Ω–∏ RSI</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ -->
        <ul class="nav nav-tabs mb-4">
            <li class="nav-item">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#signals">
                    <i class="fas fa-chart-line"></i> –°–∏–≥–Ω–∞–ª—ã
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#settings">
                    <i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#users" onclick="refreshTelegramUsers()">
                    <i class="fas fa-users"></i> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                </button>
            </li>
        </ul>

        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–æ–∫ -->
        <div class="tab-content">
            <!-- –í–∫–ª–∞–¥–∫–∞ –°–∏–≥–Ω–∞–ª—ã -->
            <div class="tab-pane fade show active" id="signals">
                <!-- –¢–µ–∫—É—â–∏–µ RSI –∑–Ω–∞—á–µ–Ω–∏—è -->
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5><i class="fas fa-tachometer-alt"></i> –¢–µ–∫—É—â–∏–µ RSI –∑–Ω–∞—á–µ–Ω–∏—è</h5>
                        <button class="btn btn-outline-primary btn-sm" onclick="refreshCurrentRSI()">
                            <i class="fas fa-sync-alt" id="rsi-refresh-icon"></i> –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="current-rsi-container">
                            <div class="text-center py-4">
                                <div class="spinner-border text-primary"></div>
                                <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–∏—Ö RSI –∑–Ω–∞—á–µ–Ω–∏–π...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è RSI —Å–∏–≥–Ω–∞–ª–æ–≤</h5>
                    </div>
                    <div class="card-body">
                        <!-- –§–∏–ª—å—Ç—Ä—ã -->
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <select class="form-select" id="symbol-filter">
                                    <option value="">–í—Å–µ –º–æ–Ω–µ—Ç—ã</option>
                                    {% for symbol in settings.symbols %}
                                    <option value="{{ symbol }}">{{ symbol }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="signal-type-filter">
                                    <option value="">–í—Å–µ —Ç–∏–ø—ã —Å–∏–≥–Ω–∞–ª–æ–≤</option>
                                    <option value="important">–¢–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã–µ (–≤—Ö–æ–¥—ã –≤ –∑–æ–Ω—ã)</option>
                                    <option value="oversold_enter">üî¥ –¢–æ–ª—å–∫–æ –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å</option>
                                    <option value="overbought_enter">üü° –¢–æ–ª—å–∫–æ –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-outline-primary w-100" onclick="refreshSignalsHistory()">
                                    <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                                </button>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-warning w-100" onclick="clearCacheAndReload()">
                                    <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
                                </button>
                            </div>
                        </div>

                        <!-- –ì—Ä—É–ø–ø—ã —Å–∏–≥–Ω–∞–ª–æ–≤ -->
                        <div style="max-height: 700px; overflow-y: auto;" id="signals-history-container">
                            <div id="today-section" class="mb-4">
                                <h6 class="text-primary border-bottom pb-2"><i class="fas fa-calendar-day"></i> –°–µ–≥–æ–¥–Ω—è</h6>
                                <div id="today-signals"><div class="text-center text-muted py-3"><small>–ó–∞–≥—Ä—É–∑–∫–∞...</small></div></div>
                            </div>
                            <div id="this-week-section" class="mb-4">
                                <h6 class="text-info border-bottom pb-2"><i class="fas fa-calendar-week"></i> –ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ</h6>
                                <div id="this-week-signals"><div class="text-center text-muted py-3"><small>–ó–∞–≥—Ä—É–∑–∫–∞...</small></div></div>
                            </div>
                            <div id="last-week-section" class="mb-4">
                                <h6 class="text-secondary border-bottom pb-2"><i class="fas fa-calendar-alt"></i> –ù–∞ –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–µ</h6>
                                <div id="last-week-signals"><div class="text-center text-muted py-3"><small>–ó–∞–≥—Ä—É–∑–∫–∞...</small></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
            <div class="tab-pane fade" id="settings">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞</h5>
                            </div>
                            <div class="card-body">
                                <form id="settings-form">
                                    <!-- –¢–∞–π–º—Ñ—Ä–µ–π–º -->
                                    <div class="mb-4">
                                        <label class="form-label"><strong>üìä –¢–∞–π–º—Ñ—Ä–µ–π–º –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</strong></label>
                                        <select class="form-select" id="timeframe">
                                            {% for tf in available_timeframes %}
                                            <option value="{{ tf }}" {% if tf == settings.timeframe %}selected{% endif %}>
                                                {{ tf }} {% if tf == '5m' %}(—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è){% endif %}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </div>

                                    <!-- RSI —É—Ä–æ–≤–Ω–∏ -->
                                    <div class="mb-4">
                                        <label class="form-label"><strong>‚öôÔ∏è –£—Ä–æ–≤–Ω–∏ RSI</strong></label>
                                        <div class="alert alert-info">
                                            <i class="fas fa-info-circle"></i> 
                                            <strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É—Ä–æ–≤–Ω–∏:</strong><br>
                                            üî¥ –ü–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å: {{ settings.rsi_oversold }}<br>
                                            üü° –ü–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å: {{ settings.rsi_overbought }}<br>
                                            <small>–≠—Ç–∏ —É—Ä–æ–≤–Ω–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã –∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è</small>
                                        </div>
                                    </div>

                                    <!-- –°–∏–º–≤–æ–ª—ã -->
                                    <div class="mb-4">
                                        <label class="form-label"><strong>üí∞ –ú–æ–Ω–µ—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</strong></label>
                                        
                                        <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ -->
                                        <div class="alert alert-warning mb-3">
                                            <h6><i class="fas fa-lightbulb"></i> –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–≤–æ–¥–∏—Ç—å —Å–∏–º–≤–æ–ª—ã:</h6>
                                            <ul class="mb-2">
                                                <li><strong>–§–æ—Ä–º–∞—Ç:</strong> <code>BTCUSDT</code> (–Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–Ω–µ—Ç—ã + USDT)</li>
                                                <li><strong>–ü—Ä–∏–º–µ—Ä—ã:</strong> BTC, DOGE, PEPE, SUI, BIGTIME, ALT, WLD</li>
                                                <li><strong>–ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ:</strong> –º–æ–∂–Ω–æ –≤–≤–æ–¥–∏—Ç—å –±–µ–∑ USDT</li>
                                                <li><strong>–†–µ–≥–∏—Å—Ç—Ä:</strong> –Ω–µ –≤–∞–∂–µ–Ω</li>
                                            </ul>
                                        </div>

                                        <!-- –ë—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ -->
                                        <div class="mb-3">
                                            <label class="form-label">üöÄ –ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ:</label>
                                            <div class="d-flex flex-wrap gap-2 mb-3">
                                                <button type="button" class="btn btn-outline-success btn-sm" onclick="addQuickSymbol('BTC')">‚Çø BTC</button>
                                                <button type="button" class="btn btn-outline-success btn-sm" onclick="addQuickSymbol('ETH')">Œû ETH</button>
                                                <button type="button" class="btn btn-outline-success btn-sm" onclick="addQuickSymbol('DOGE')">üêï DOGE</button>
                                                <button type="button" class="btn btn-outline-success btn-sm" onclick="addQuickSymbol('PEPE')">üê∏ PEPE</button>
                                                <button type="button" class="btn btn-outline-success btn-sm" onclick="addQuickSymbol('SUI')">üåä SUI</button>
                                                <button type="button" class="btn btn-outline-success btn-sm" onclick="addQuickSymbol('BIGTIME')">‚è∞ BIGTIME</button>
                                                <button type="button" class="btn btn-outline-success btn-sm" onclick="addQuickSymbol('ALT')">‚≠ê ALT</button>
                                                <button type="button" class="btn btn-outline-success btn-sm" onclick="addQuickSymbol('WLD')">üåç WLD</button>
                                            </div>
                                        </div>

                                        <!-- –°–ø–∏—Å–æ–∫ —Å–∏–º–≤–æ–ª–æ–≤ -->
                                        <div id="symbols-container">
                                            {% for symbol in settings.symbols %}
                                            <div class="input-group mb-2 symbol-input">
                                                <span class="input-group-text">üí∞</span>
                                                <input type="text" class="form-control" value="{{ symbol }}" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: BTCUSDT">
                                                <button class="btn btn-outline-danger" type="button" onclick="removeSymbol(this)">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                            {% endfor %}
                                        </div>
                                        
                                        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                                        <div class="d-flex gap-2 mb-3">
                                            <button type="button" class="btn btn-outline-primary btn-sm" onclick="addSymbol()">
                                                <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å
                                            </button>
                                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="clearAllSymbols()">
                                                <i class="fas fa-broom"></i> –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ
                                            </button>
                                        </div>
                                        
                                        <!-- –°—á–µ—Ç—á–∏–∫ -->
                                        <div class="mt-2">
                                            <small class="text-muted">
                                                –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: <span id="symbols-count">{{ settings.symbols|length }}</span>
                                                (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 3-8 –º–æ–Ω–µ—Ç)
                                            </small>
                                        </div>
                                    </div>

                                    <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
                                    <button type="submit" class="btn btn-success w-100 btn-lg">
                                        <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-info-circle"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-6">
                                        <div class="text-center">
                                            <h4 class="text-primary">{{ settings.symbols|length }}</h4>
                                            <small class="text-muted">–ê–∫—Ç–∏–≤–Ω—ã—Ö –º–æ–Ω–µ—Ç</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="text-center">
                                            <h4 class="text-info">{{ settings.timeframe }}</h4>
                                            <small class="text-muted">–¢–∞–π–º—Ñ—Ä–µ–π–º</small>
                                        </div>
                                    </div>
                                </div>
                                <hr>
                                <div class="alert alert-info mb-0">
                                    <h6><i class="fas fa-lightbulb"></i> –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h6>
                                    <ul class="mb-0">
                                        <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ 3-8 –º–æ–Ω–µ—Ç –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã</li>
                                        <li>–¢–∞–π–º—Ñ—Ä–µ–π–º 5m –¥–∞–µ—Ç –±–æ–ª—å—à–µ —Å–∏–≥–Ω–∞–ª–æ–≤</li>
                                        <li>RSI —É—Ä–æ–≤–Ω–∏ 30/70 —è–≤–ª—è—é—Ç—Å—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º–∏</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
            <div class="tab-pane fade" id="users">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5><i class="fas fa-users"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ Telegram</h5>
                        <button class="btn btn-outline-primary btn-sm" onclick="refreshTelegramUsers()">
                            <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                    </div>
                    <div class="card-body">
                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                        <div class="alert alert-info mb-4">
                            <h6><i class="fas fa-info-circle"></i> –°–∏—Å—Ç–µ–º–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏:</h6>
                            <ul class="mb-2">
                                <li>–î–æ–±–∞–≤–ª—è–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É –Ω–∏–∂–µ</li>
                                <li>–ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ—è–≤—è—Ç—Å—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–û–∂–∏–¥–∞–µ—Ç –º–æ–¥–µ—Ä–∞—Ü–∏–∏"</li>
                                <li>–í—ã –º–æ–∂–µ—Ç–µ –æ–¥–æ–±—Ä–∏—Ç—å –∏–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</li>
                                <li>–¢–æ–ª—å–∫–æ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç RSI —Å–∏–≥–Ω–∞–ª—ã</li>
                            </ul>
                            <small class="text-muted">
                                <strong>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å Telegram ID:</strong> –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É <a href="https://t.me/userinfobot" target="_blank">@userinfobot</a> –∏–ª–∏ <a href="https://t.me/getmyid_bot" target="_blank">@getmyid_bot</a>
                            </small>
                        </div>

                        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fas fa-user-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h6>
                            </div>
                            <div class="card-body">
                                <form id="add-user-form">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="user-id">Telegram User ID / Chat ID <span class="text-danger">*</span></label>
                                                <input type="number" class="form-control" id="user-id" required 
                                                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 123456789">
                                                <small class="form-text text-muted">
                                                    –î–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —á–∞—Ç–æ–≤ User ID = Chat ID
                                                </small>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="user-username">Username (–±–µ–∑ @)</label>
                                                <input type="text" class="form-control" id="user-username" 
                                                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: john_doe">
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label for="user-first-name">–ò–º—è</label>
                                                <input type="text" class="form-control" id="user-first-name" 
                                                       placeholder="–ò–≤–∞–Ω">
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label for="user-last-name">–§–∞–º–∏–ª–∏—è</label>
                                                <input type="text" class="form-control" id="user-last-name" 
                                                       placeholder="–ü–µ—Ç—Ä–æ–≤">
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label>&nbsp;</label>
                                                <button type="submit" class="btn btn-primary w-100">
                                                    <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <div class="card bg-info text-white">
                                    <div class="card-body text-center">
                                        <h4 id="total-users-count">0</h4>
                                        <small>–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-success text-white">
                                    <div class="card-body text-center">
                                        <h4 id="approved-users-count">0</h4>
                                        <small>–û–¥–æ–±—Ä–µ–Ω–æ</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-warning text-dark">
                                    <div class="card-body text-center">
                                        <h4 id="pending-users-count">0</h4>
                                        <small>–û–∂–∏–¥–∞—é—Ç –º–æ–¥–µ—Ä–∞—Ü–∏–∏</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-danger text-white">
                                    <div class="card-body text-center">
                                        <h4 id="blocked-users-count">0</h4>
                                        <small>–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                        <div id="telegram-users-container">
                            <div class="text-center py-4">
                                <div class="spinner-border text-primary"></div>
                                <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤ –∏ RSI
        setInterval(refreshSignalsHistory, 30000);
        setInterval(refreshCurrentRSI, 60000); // –û–±–Ω–æ–≤–ª—è–µ–º RSI –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É

        function refreshData() {
            const icon = document.getElementById('refresh-icon');
            icon.classList.add('refresh-btn');
            refreshSignalsHistory();
            refreshCurrentRSI();
            setTimeout(() => icon.classList.remove('refresh-btn'), 2000);
        }

        function clearCacheAndReload() {
            if ('caches' in window) {
                caches.keys().then(names => names.forEach(name => caches.delete(name)));
            }
            window.location.reload(true);
        }

        // –†–∞–±–æ—Ç–∞ —Å —Ç–µ–∫—É—â–∏–º–∏ RSI
        async function refreshCurrentRSI() {
            try {
                const icon = document.getElementById('rsi-refresh-icon');
                icon.classList.add('fa-spin');
                
                const timestamp = new Date().getTime();
                const response = await fetch(`/api/current_rsi?_t=${timestamp}`);
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                displayCurrentRSI(data.symbols);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–µ–∫—É—â–∏—Ö RSI:', error);
                document.getElementById('current-rsi-container').innerHTML = 
                    '<div class="alert alert-warning">‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ RSI –¥–∞–Ω–Ω—ã—Ö</div>';
            } finally {
                const icon = document.getElementById('rsi-refresh-icon');
                icon?.classList.remove('fa-spin');
            }
        }

        function displayCurrentRSI(symbols) {
            const container = document.getElementById('current-rsi-container');
            
            if (!symbols || symbols.length === 0) {
                container.innerHTML = '<div class="alert alert-info">üìä –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö RSI –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>';
                return;
            }
            
            const symbolEmoji = {
                'BTCUSDT': '‚Çø', 'ETHUSDT': 'Œû', 'DOGEUSDT': 'üêï', 'PEPEUSDT': 'üê∏',
                'SUIUSDT': 'üåä', 'BIGTIMEUSDT': '‚è∞', 'ALTUSDT': '‚≠ê',
                'WLDUSDT': 'üåç'
            };
            
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            
            let html = `<div class="row mb-3">`;
            
            symbols.forEach((symbol, index) => {
                const emoji = symbolEmoji[symbol.symbol] || 'üí∞';
                const symbolName = symbol.symbol.replace('USDT', '');
                
                let cardClass = 'border-secondary';
                let textClass = 'text-dark';
                let rsiDisplay = 'N/A';
                let priceDisplay = 'N/A';
                
                if (symbol.status === 'error' || symbol.status === 'unavailable') {
                    cardClass = 'border-secondary';
                    textClass = 'text-muted';
                    rsiDisplay = 'N/A';
                } else if (symbol.rsi !== null) {
                    rsiDisplay = symbol.rsi;
                    priceDisplay = `$${symbol.price.toFixed(8)}`;
                    
                    if (symbol.status === 'oversold') {
                        cardClass = 'border-success';
                        textClass = 'text-success';
                    } else if (symbol.status === 'overbought') {
                        cardClass = 'border-danger';
                        textClass = 'text-danger';
                    }
                }
                
                html += `
                    <div class="col-md-4 col-lg-3 mb-3">
                        <div class="card ${cardClass} h-100">
                            <div class="card-body text-center p-3">
                                <h6 class="card-title mb-2">${emoji} ${symbolName}</h6>
                                <h4 class="${textClass} mb-1">${rsiDisplay}</h4>
                                <small class="text-muted d-block">RSI</small>
                                ${symbol.status !== 'error' && symbol.status !== 'unavailable' ? `
                                    <small class="text-muted d-block mt-2">${priceDisplay}</small>
                                    <span class="badge bg-${symbol.status_color} mt-2">${symbol.status_text}</span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
                
                // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –ø–æ—Å–ª–µ –∫–∞–∂–¥—ã—Ö 4 —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                if ((index + 1) % 4 === 0) {
                    html += `</div><div class="row mb-3">`;
                }
            });
            
            html += `</div>`;
            html += `<div class="text-center mt-3">
                        <small class="text-muted">
                            <i class="fas fa-clock"></i> –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${timeStr}
                        </small>
                     </div>`;
            
            container.innerHTML = html;
        }

        // –†–∞–±–æ—Ç–∞ —Å —Å–∏–≥–Ω–∞–ª–∞–º–∏
        async function refreshSignalsHistory() {
            try {
                const timestamp = new Date().getTime();
                const response = await fetch(`/api/signals?limit=200&_t=${timestamp}`);
                const signals = await response.json();
                groupAndDisplaySignals(signals);
                document.getElementById('total-signals').textContent = signals.length;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤:', error);
            }
        }

        function groupAndDisplaySignals(signals) {
            const symbolFilter = document.getElementById('symbol-filter').value;
            const typeFilter = document.getElementById('signal-type-filter').value;
            
            let filteredSignals = signals;
            
            if (symbolFilter) {
                filteredSignals = filteredSignals.filter(s => s.symbol === symbolFilter);
            }
            
            if (typeFilter === 'important') {
                filteredSignals = filteredSignals.filter(s => 
                    s.signal_type === 'oversold_enter' || s.signal_type === 'overbought_enter'
                );
            } else if (typeFilter) {
                filteredSignals = filteredSignals.filter(s => s.signal_type === typeFilter);
            }
            
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const thisWeekStart = new Date(today.getTime() - (today.getDay() * 24 * 60 * 60 * 1000));
            const lastWeekStart = new Date(thisWeekStart.getTime() - (7 * 24 * 60 * 60 * 1000));
            
            const todaySignals = [];
            const thisWeekSignals = [];
            const lastWeekSignals = [];
            
            filteredSignals.forEach(signal => {
                const signalDate = new Date(signal.timestamp);
                if (signalDate >= today) {
                    todaySignals.push(signal);
                } else if (signalDate >= thisWeekStart) {
                    thisWeekSignals.push(signal);
                } else if (signalDate >= lastWeekStart) {
                    lastWeekSignals.push(signal);
                }
            });
            
            displaySignalGroup('today-signals', todaySignals, '–°–µ–≥–æ–¥–Ω—è —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
            displaySignalGroup('this-week-signals', thisWeekSignals, '–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
            displaySignalGroup('last-week-signals', lastWeekSignals, '–ù–∞ –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–µ —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
        }
        
        function displaySignalGroup(containerId, signals, emptyMessage) {
            const container = document.getElementById(containerId);
            
            if (signals.length === 0) {
                container.innerHTML = `<div class="text-center text-muted py-3"><small>${emptyMessage}</small></div>`;
                return;
            }
            
            container.innerHTML = signals.map(signal => createSignalCard(signal)).join('');
        }
        
        function createSignalCard(signal) {
            const signalType = signal.signal_type;
            let badgeClass = 'bg-primary';
            let signalText = '–°–∏–≥–Ω–∞–ª';
            
            if (signalType.includes('oversold')) {
                if (signalType.includes('enter')) {
                    badgeClass = 'bg-danger';
                    signalText = 'üî¥ –ü–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω';
                } else {
                    badgeClass = 'bg-success';
                    signalText = 'üü¢ –í—ã—Ö–æ–¥ –∏–∑ –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω';
                }
            } else if (signalType.includes('overbought')) {
                if (signalType.includes('enter')) {
                    badgeClass = 'bg-warning text-dark';
                    signalText = 'üü° –ü–µ—Ä–µ–∫—É–ø–ª–µ–Ω';
                } else {
                    badgeClass = 'bg-info';
                    signalText = 'üîµ –í—ã—Ö–æ–¥ –∏–∑ –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω';
                }
            }
            
            const signalDate = new Date(signal.timestamp);
            const dateStr = signalDate.toLocaleDateString('ru-RU');
            const timeStr = signalDate.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            
            const symbolEmoji = {
                'BTCUSDT': '‚Çø', 'DOGEUSDT': 'üêï', 'PEPEUSDT': 'üê∏',
                'SUIUSDT': 'üåä', 'BIGTIMEUSDT': '‚è∞', 'ALTUSDT': '‚≠ê',
                'WLDUSDT': 'üåç'
            }[signal.symbol] || 'üí∞';
            
            return `
                <div class="card signal-card mb-2">
                    <div class="card-body py-2">
                        <div class="row align-items-center">
                            <div class="col-2">
                                <strong>${symbolEmoji} ${signal.symbol.replace('USDT', '')}</strong>
                                <br><small class="text-muted">${signal.timeframe}</small>
                            </div>
                            <div class="col-3">
                                <span class="badge ${badgeClass}">${signalText}</span>
                                <br><small class="text-muted">${dateStr} ${timeStr}</small>
                            </div>
                            <div class="col-3">
                                <small>RSI: <strong>${signal.rsi_value.toFixed(2)}</strong></small>
                                <br><small>–¶–µ–Ω–∞: <strong>$${signal.price.toFixed(6)}</strong></small>
                            </div>
                            <div class="col-2">
                                <small class="text-muted">–ü—Ä–µ–¥—ã–¥—É—â–∏–π RSI:</small>
                                <br><small><strong>${signal.previous_rsi ? signal.previous_rsi.toFixed(2) : 'N/A'}</strong></small>
                            </div>
                            <div class="col-2 text-end">
                                <a href="https://www.tradingview.com/chart/?symbol=BINANCE:${signal.symbol.replace('USDT', 'USD')}" 
                                   target="_blank" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-chart-line"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // –†–∞–±–æ—Ç–∞ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
        function addSymbol() {
            const container = document.getElementById('symbols-container');
            const div = document.createElement('div');
            div.className = 'input-group mb-2 symbol-input';
            div.innerHTML = `
                <span class="input-group-text">üí∞</span>
                <input type="text" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: BTCUSDT">
                <button class="btn btn-outline-danger" type="button" onclick="removeSymbol(this)">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            container.appendChild(div);
            updateSymbolsCount();
        }

        function removeSymbol(button) {
            button.closest('.symbol-input').remove();
            updateSymbolsCount();
        }

        function addQuickSymbol(symbol) {
            const inputs = document.querySelectorAll('#symbols-container input');
            const symbolWithUsdt = symbol.toUpperCase().endsWith('USDT') ? symbol.toUpperCase() : symbol.toUpperCase() + 'USDT';
            
            for (let input of inputs) {
                const currentValue = input.value.trim().toUpperCase();
                const currentWithUsdt = currentValue.endsWith('USDT') ? currentValue : currentValue + 'USDT';
                if (currentWithUsdt === symbolWithUsdt) {
                    input.style.border = '2px solid #28a745';
                    setTimeout(() => input.style.border = '', 2000);
                    return;
                }
            }
            
            const container = document.getElementById('symbols-container');
            const div = document.createElement('div');
            div.className = 'input-group mb-2 symbol-input';
            div.innerHTML = `
                <span class="input-group-text">üí∞</span>
                <input type="text" class="form-control" value="${symbolWithUsdt}">
                <button class="btn btn-outline-danger" type="button" onclick="removeSymbol(this)">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            container.appendChild(div);
            updateSymbolsCount();
        }

        function clearAllSymbols() {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –º–æ–Ω–µ—Ç—ã?')) {
                document.getElementById('symbols-container').innerHTML = '';
                updateSymbolsCount();
            }
        }

        function updateSymbolsCount() {
            const count = document.querySelectorAll('#symbols-container .symbol-input').length;
            document.getElementById('symbols-count').textContent = count;
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫
        document.getElementById('settings-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const symbolInputs = document.querySelectorAll('#symbols-container input');
            const symbols = Array.from(symbolInputs)
                .map(input => input.value.trim().toUpperCase())
                .filter(value => value)
                .map(symbol => symbol.endsWith('USDT') ? symbol : symbol + 'USDT');
            
            if (symbols.length === 0) {
                alert('‚ö†Ô∏è –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –º–æ–Ω–µ—Ç—É!');
                return;
            }
            
            const settings = {
                symbols: [...new Set(symbols)],
                timeframe: document.getElementById('timeframe').value
            };
            
            const submitBtn = document.querySelector('#settings-form button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
            submitBtn.disabled = true;
            
            try {
                const response = await fetch('/api/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(settings)
                });
                
                if (response.ok) {
                    submitBtn.innerHTML = '<i class="fas fa-check"></i> –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!';
                    submitBtn.className = 'btn btn-success w-100 btn-lg';
                    setTimeout(() => location.reload(), 1500);
                } else {
                    const result = await response.json();
                    throw new Error(result.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                }
            } catch (error) {
                alert(`‚ùå ${error.message}`);
                submitBtn.innerHTML = originalText;
                submitBtn.className = 'btn btn-success w-100 btn-lg';
                submitBtn.disabled = false;
            }
        });

        // –†–∞–±–æ—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ Telegram
        async function refreshTelegramUsers() {
            try {
                const response = await fetch('/api/telegram_users');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—É—á–∏–ª–∏ –º–∞—Å—Å–∏–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                if (!Array.isArray(data)) {
                    // –ï—Å–ª–∏ —ç—Ç–æ –æ–±—ä–µ–∫—Ç –æ—à–∏–±–∫–∏
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    throw new Error('–ü–æ–ª—É—á–µ–Ω –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
                }
                
                displayTelegramUsers(data);
                updateUserStatistics(data);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                document.getElementById('telegram-users-container').innerHTML = 
                    `<div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle"></i> 
                        –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${error.message}
                    </div>`;
                
                // –û–±–Ω—É–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ –æ—à–∏–±–∫–µ
                document.getElementById('total-users-count').textContent = '0';
                document.getElementById('approved-users-count').textContent = '0';
                document.getElementById('pending-users-count').textContent = '0';
                document.getElementById('blocked-users-count').textContent = '0';
            }
        }
        
        function displayTelegramUsers(users) {
            const container = document.getElementById('telegram-users-container');
            
            if (users.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4">
                        <i class="fas fa-users fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</h5>
                        <p class="text-muted">–î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É –≤—ã—à–µ</p>
                    </div>
                `;
                return;
            }
            
            const pending = users.filter(u => u.status === 'pending');
            const approved = users.filter(u => u.status === 'approved');
            const blocked = users.filter(u => u.status === 'blocked');
            
            let html = '';
            
            if (pending.length > 0) {
                html += '<h6 class="text-warning mb-3"><i class="fas fa-clock"></i> –û–∂–∏–¥–∞—é—Ç –º–æ–¥–µ—Ä–∞—Ü–∏–∏:</h6>';
                pending.forEach(user => html += createUserCard(user));
            }
            
            if (approved.length > 0) {
                html += '<h6 class="text-success mb-3 mt-4"><i class="fas fa-check-circle"></i> –û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ:</h6>';
                approved.forEach(user => html += createUserCard(user));
            }
            
            if (blocked.length > 0) {
                html += '<h6 class="text-danger mb-3 mt-4"><i class="fas fa-ban"></i> –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ:</h6>';
                blocked.forEach(user => html += createUserCard(user));
            }
            
            container.innerHTML = html;
        }
        
        function createUserCard(user) {
            const statusBadge = {
                'pending': '<span class="badge bg-warning text-dark">–û–∂–∏–¥–∞–µ—Ç</span>',
                'approved': '<span class="badge bg-success">–û–¥–æ–±—Ä–µ–Ω</span>',
                'blocked': '<span class="badge bg-danger">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span>'
            }[user.status];
            
            const displayName = user.first_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            const username = user.username ? `@${user.username}` : '–ù–µ—Ç username';
            const createdDate = new Date(user.created_at).toLocaleDateString('ru-RU');
            
            const actions = user.status === 'pending' 
                ? `<button class="btn btn-success btn-sm me-2" onclick="approveUser(${user.user_id})">
                     <i class="fas fa-check"></i> –û–¥–æ–±—Ä–∏—Ç—å
                   </button>
                   <button class="btn btn-danger btn-sm me-2" onclick="blockUser(${user.user_id})">
                     <i class="fas fa-ban"></i> –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
                   </button>`
                : user.status === 'approved'
                ? `<button class="btn btn-warning btn-sm me-2" onclick="blockUser(${user.user_id})">
                     <i class="fas fa-ban"></i> –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
                   </button>`
                : `<button class="btn btn-success btn-sm me-2" onclick="approveUser(${user.user_id})">
                     <i class="fas fa-check"></i> –û–¥–æ–±—Ä–∏—Ç—å
                   </button>`;
            
            return `
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <h6 class="mb-1">${displayName}</h6>
                                <small class="text-muted">${username}</small>
                                <br><small class="text-muted">ID: ${user.user_id}</small>
                            </div>
                            <div class="col-md-2">${statusBadge}</div>
                            <div class="col-md-2">
                                <small class="text-muted">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:</small>
                                <br><small>${createdDate}</small>
                            </div>
                            <div class="col-md-3">${actions}</div>
                            <div class="col-md-2 text-end">
                                <button class="btn btn-outline-danger btn-sm" onclick="deleteUser(${user.user_id})">
                                    <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function updateUserStatistics(users) {
            const total = users.length;
            const approved = users.filter(u => u.status === 'approved').length;
            const pending = users.filter(u => u.status === 'pending').length;
            const blocked = users.filter(u => u.status === 'blocked').length;
            
            document.getElementById('total-users-count').textContent = total;
            document.getElementById('approved-users-count').textContent = approved;
            document.getElementById('pending-users-count').textContent = pending;
            document.getElementById('blocked-users-count').textContent = blocked;
        }
        
        async function approveUser(userId) {
            if (!confirm('–û–¥–æ–±—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) return;
            
            try {
                const response = await fetch(`/api/telegram_users/${userId}/approve`, { method: 'POST' });
                if (response.ok) {
                    await refreshTelegramUsers();
                    alert('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–¥–æ–±—Ä–µ–Ω');
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è');
                }
            } catch (error) {
                alert('‚ùå ' + error.message);
            }
        }
        
        async function blockUser(userId) {
            if (!confirm('–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) return;
            
            try {
                const response = await fetch(`/api/telegram_users/${userId}/block`, { method: 'POST' });
                if (response.ok) {
                    await refreshTelegramUsers();
                    alert('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω');
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏');
                }
            } catch (error) {
                alert('‚ùå ' + error.message);
            }
        }
        
        async function deleteUser(userId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è? –î–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) return;
            
            try {
                const response = await fetch(`/api/telegram_users/${userId}`, { method: 'DELETE' });
                if (response.ok) {
                    await refreshTelegramUsers();
                    alert('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω');
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è');
                }
            } catch (error) {
                alert('‚ùå ' + error.message);
            }
        }

        // –§–∏–ª—å—Ç—Ä—ã
        document.getElementById('symbol-filter').addEventListener('change', refreshSignalsHistory);
        document.getElementById('signal-type-filter').addEventListener('change', refreshSignalsHistory);

        // –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        document.getElementById('add-user-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const userId = document.getElementById('user-id').value;
            const username = document.getElementById('user-username').value;
            const firstName = document.getElementById('user-first-name').value;
            const lastName = document.getElementById('user-last-name').value;
            
            if (!userId) {
                alert('‚ö†Ô∏è User ID –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω!');
                return;
            }
            
            const userData = {
                user_id: parseInt(userId),
                username: username.trim(),
                first_name: firstName.trim(),
                last_name: lastName.trim()
            };
            
            const submitBtn = document.querySelector('#add-user-form button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –î–æ–±–∞–≤–ª–µ–Ω–∏–µ...';
            submitBtn.disabled = true;
            
            try {
                const response = await fetch('/api/telegram_users', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(userData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    submitBtn.innerHTML = '<i class="fas fa-check"></i> –î–æ–±–∞–≤–ª–µ–Ω!';
                    submitBtn.className = 'btn btn-success w-100';
                    
                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                    document.getElementById('add-user-form').reset();
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                    await refreshTelegramUsers();
                    
                    alert('‚úÖ ' + result.message);
                    
                    setTimeout(() => {
                        submitBtn.innerHTML = originalText;
                        submitBtn.className = 'btn btn-primary w-100';
                        submitBtn.disabled = false;
                    }, 2000);
                } else {
                    throw new Error(result.error || '–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è');
                }
            } catch (error) {
                alert('‚ùå ' + error.message);
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            refreshSignalsHistory();
            refreshCurrentRSI();
            updateSymbolsCount();
        });
    </script>
</body>
</html> 